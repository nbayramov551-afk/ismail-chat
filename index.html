<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHANTOM V26</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; height: 100vh; width: 100vw; }
        #login-screen { position: fixed; inset: 0; z-index: 3000; background: radial-gradient(circle, #001a00 0%, #000 100%); display: flex; align-items: center; justify-content: center; }
        .terminal-box { border: 2px solid #0f0; padding: 30px; width: 85%; max-width: 320px; text-align: center; background: rgba(0,0,0,0.9); box-shadow: 0 0 20px #0f0; border-radius:15px; }
        input { background: #000; border: 1px solid #0f0; color: #0f0; padding: 12px; margin: 10px 0; width: 100%; box-sizing: border-box; outline: none; text-align: center; font-size: 18px; border-radius:5px; }
        .start-btn { width: 100%; padding: 15px; background: #0f0; color: #000; font-weight: bold; cursor: pointer; border: none; border-radius:5px; text-transform: uppercase; margin-top:10px; font-size:16px; transition: 0.2s; }
        .start-btn:active { transform: scale(0.95); opacity: 0.8; }

        #radar-screen { position: fixed; inset: 0; z-index: 2000; background: #000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .radar-ring { width: 150px; height: 150px; border: 2px solid #0f0; border-radius: 50%; position: relative; box-shadow: 0 0 15px #0f0; }
        .radar-sweep { width: 50%; height: 2px; background: #0f0; position: absolute; top: 50%; left: 50%; transform-origin: left; animation: sweep 2s linear infinite; box-shadow: 0 0 10px #0f0; }
        @keyframes sweep { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        #main-ui { display: none; width: 100%; height: 100%; position: relative; background: #000; }
        #remote-video { width: 100%; height: 100%; object-fit: cover; }
        #local-video { position: absolute; bottom: 100px; right: 20px; width: 110px; height: 160px; border: 2px solid #fff; z-index: 10; border-radius: 12px; object-fit: cover; background: #222; box-shadow: 0 0 15px rgba(0,0,0,0.5); }

        .emoji-bar { position: absolute; top: 45%; right: 10px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 12px; z-index: 20; }
        .emoji-btn { font-size: 28px; background: rgba(0,0,0,0.5); border: 1px solid rgba(0,255,0,0.3); border-radius: 50%; width: 50px; height: 50px; color: #fff; backdrop-filter: blur(5px); }

        .control-panel { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 20; background: rgba(0,0,0,0.8); padding: 12px 25px; border-radius: 50px; border: 1px solid #0f0; }
        .btn { width: 45px; height: 45px; border-radius: 50%; border: none; background: #1a1a1a; color: #fff; font-size: 20px; }
        .active-red { background: #ff0000 !important; }

        .status-msg { position: fixed; bottom: 10px; left: 10px; font-size: 10px; color: #0f0; opacity: 0.5; z-index: 4000; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="terminal-box">
            <h2 style="color: #0f0; margin-bottom: 20px; letter-spacing: 2px;">PHANTOM V26</h2>
            <input type="password" id="tk" placeholder="ÅžÄ°FRÆ (MÉ™s: 777)">
            <input type="text" id="rm" placeholder="OTAQ (MÉ™s: baku)">
            <button class="start-btn" onclick="ignite('A')">HOST OL (AZ)</button>
            <button class="start-btn" onclick="ignite('B')" style="background:#003300; color:#0f0; border: 1px solid #0f0;">QOÅžUL (RU)</button>
        </div>
    </div>

    <div id="radar-screen">
        <div class="radar-ring"><div class="radar-sweep"></div></div>
        <p style="margin-top:30px; color:#0f0; font-weight: bold; animation: blink 1s infinite;" id="radar-text">TUNEL AXTARILIR...</p>
    </div>

    <div id="main-ui">
        <video id="remote-video" playsinline autoplay></video>
        <video id="local-video" autoplay muted playsinline></video>
        <div class="emoji-bar" id="emoji-list"></div>
        <div class="control-panel">
            <button class="btn" onclick="mute()" id="m-btn"><i class="fas fa-microphone"></i></button>
            <button class="btn" onclick="cam()" id="c-btn"><i class="fas fa-video"></i></button>
            <button class="btn" onclick="flip()"><i class="fas fa-camera-rotate"></i></button>
            <button class="btn" onclick="location.reload()" style="background:#333;"><i class="fas fa-sync"></i></button>
            <button class="btn" onclick="window.location.href='https://google.com'" style="background:#400;"><i class="fas fa-phone-slash"></i></button>
        </div>
    </div>

    <div class="status-msg" id="debug">System Standby...</div>

    <script>
        let peer, localStream, activeConn, role, targetID, myID;
        let isFront = true;
        
        // Anti-Blok ICE ServerlÉ™ri
        const config = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' },
                { urls: 'stun:stun.voip.aebc.com:3478' },
                { urls: 'stun:stun.sipgate.net:3478' }
            ],
            sdpSemantics: 'unified-plan'
        };

        const log = (msg) => { document.getElementById('debug').innerText = msg; console.log(msg); };

        async function getMedia(facing = "user") {
            if (localStream) localStream.getTracks().forEach(t => t.stop());
            localStream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: facing, width: {ideal: 640}, height: {ideal: 480} }, 
                audio: { echoCancellation: true, noiseSuppression: true } 
            });
            document.getElementById('local-video').srcObject = localStream;
            return localStream;
        }

        async function ignite(selRole) {
            role = selRole;
            const tk = document.getElementById('tk').value;
            const rm = document.getElementById('rm').value;
            if(!tk || !rm) return;

            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('radar-screen').style.display = 'flex';

            // ID-lÉ™ri mÃ¼tlÉ™q ÅŸÉ™kildÉ™ eynilÉ™ÅŸdiririk
            const hash = CryptoJS.MD5(tk.trim().toLowerCase() + rm.trim().toLowerCase()).toString().substring(0, 12);
            myID = (role === 'A' ? 'AZ-' : 'RU-') + hash;
            targetID = (role === 'A' ? 'RU-' : 'AZ-') + hash;

            log("ID: " + myID);

            try {
                await getMedia();
                // PeerJS-i fÉ™rqli konfiqurasiya ilÉ™ baÅŸlat
                peer = new Peer(myID, { 
                    config: config,
                    debug: 1,
                    secure: true
                });

                peer.on('open', (id) => {
                    log("ServerÉ™ qoÅŸuldu: " + id);
                    // MÃœTLÆQ TAPMA DÃ–NGÃœSÃœ
                    setInterval(() => {
                        if (document.getElementById('main-ui').style.display === 'none') {
                            log("HÉ™dÉ™f axtarÄ±lÄ±r: " + targetID);
                            const call = peer.call(targetID, localStream);
                            if(call) handleCall(call);
                            peer.connect(targetID);
                        }
                    }, 2500); 
                });

                peer.on('call', call => {
                    log("ZÉ™ng gÉ™ldi!");
                    call.answer(localStream);
                    handleCall(call);
                });

                peer.on('connection', conn => {
                    activeConn = conn;
                    conn.on('data', d => { if(d.type==='emoji') showEmoji(d.val); });
                });

                peer.on('error', (err) => {
                    log("XÉ™ta: " + err.type);
                    if(err.type === 'peer-unavailable') return; // Normal haldÄ±r
                });

            } catch(e) { 
                alert("Kamera icazÉ™si vacibdir!"); 
                location.reload();
            }
        }

        function handleCall(call) {
            call.on('stream', stream => {
                const rv = document.getElementById('remote-video');
                if(rv.srcObject !== stream) {
                    rv.srcObject = stream;
                    document.getElementById('radar-screen').style.display = 'none';
                    document.getElementById('main-ui').style.display = 'block';
                    log("BaÄŸlantÄ± uÄŸurlu!");
                }
            });
        }

        async function flip() {
            isFront = !isFront;
            await getMedia(isFront ? "user" : "environment");
            if (peer) {
                const call = peer.call(targetID, localStream);
                if(call) handleCall(call);
            }
        }

        function mute() {
            localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;
            document.getElementById('m-btn').classList.toggle('active-red');
        }
        function cam() {
            localStream.getVideoTracks()[0].enabled = !localStream.getVideoTracks()[0].enabled;
            document.getElementById('c-btn').classList.toggle('active-red');
        }

        // Emoji Sistemi
        const emojis = ['â¤ï¸','ðŸ˜˜','ðŸ”¥','ðŸ˜‚','ðŸ˜','ðŸ”ž','ðŸ’','ðŸ˜­'];
        const list = document.getElementById('emoji-list');
        emojis.forEach(e => {
            const b = document.createElement('button');
            b.className = 'emoji-btn';
            b.innerText = e;
            b.onclick = () => {
                showEmoji(e);
                if(activeConn) activeConn.send({type:'emoji', val:e});
            };
            list.appendChild(b);
        });

        function showEmoji(val) {
            const div = document.createElement('div');
            div.className = 'floating-emoji';
            div.innerText = val;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 1000);
        }
    </script>
</body>
</html>

