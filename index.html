<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem...</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; height: 100vh; width: 100vw; }
        
        /* Gƒ∞Rƒ∞≈û */
        #login-screen { position: fixed; inset: 0; z-index: 3000; background: #000; display: flex; align-items: center; justify-content: center; }
        .terminal-box { border: 1px solid #0f0; padding: 25px; width: 300px; text-align: center; background: #050505; }
        input { background: #000; border: 1px solid #0f0; color: #0f0; padding: 12px; margin: 10px 0; width: 100%; box-sizing: border-box; outline: none; text-align: center; }
        .start-btn { width: 100%; padding: 15px; background: #0f0; color: #000; font-weight: bold; cursor: pointer; border: none; }

        /* RADAR */
        #radar-screen { position: fixed; inset: 0; z-index: 2000; background: #000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .radar { width: 120px; height: 120px; border: 2px solid #0f0; border-radius: 50%; position: relative; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(0,255,0,0.7);} 70% {box-shadow: 0 0 0 30px rgba(0,255,0,0);} 100% {box-shadow: 0 0 0 0 rgba(0,255,0,0);} }

        /* ∆èSAS UI */
        #main-ui { display: none; width: 100%; height: 100%; position: relative; }
        #remote-video { width: 100%; height: 100%; object-fit: cover; background: #111; }
        
        /* S∆èNƒ∞N G√ñR√úNT√úN (A≈ûAƒûIDA) */
        #local-video { 
            position: absolute; bottom: 100px; right: 20px; 
            width: 110px; height: 150px; 
            border: 2px solid #0f0; z-index: 10; 
            border-radius: 8px; object-fit: cover; 
        }

        /* EMOJƒ∞ V∆è ƒ∞DAR∆èETM∆è */
        .emoji-bar { position: absolute; top: 40%; right: 10px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 12px; z-index: 20; }
        .emoji-btn { font-size: 25px; background: rgba(0,0,0,0.5); border: 1px solid #0f0; border-radius: 50%; width: 45px; height: 45px; color: #fff; }

        .control-panel { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 20; background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 50px; border: 1px solid #0f0; }
        .btn { width: 45px; height: 45px; border-radius: 50%; border: none; background: #222; color: #fff; font-size: 18px; }
        .active-red { background: #f00 !important; }

        .floating-emoji { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 100px; z-index: 100; animation: pop 1.5s forwards; pointer-events: none; }
        @keyframes pop { 0% {transform:translate(-50%,-50%) scale(0.5); opacity:1;} 100% {transform:translate(-50%,-150%) scale(2); opacity:0;} }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="terminal-box">
            <h2 style="color: #0f0;">PHANTOM V23</h2>
            <p style="font-size: 10px; color: #555;">BYPASSING RUSSIAN FIREWALL...</p>
            <input type="password" id="tk" placeholder="TOKEN">
            <input type="text" id="rm" placeholder="ROOM_ID">
            <button class="start-btn" onclick="ignite('A')">HOST (AZ)</button>
            <button class="start-btn" onclick="ignite('B')" style="margin-top:10px; background:#004400; color:#fff;">GUEST (RU)</button>
        </div>
    </div>

    <div id="radar-screen">
        <div class="radar"></div>
        <p style="margin-top:20px;" id="status-text">TUNEL QURULUR...</p>
    </div>

    <div id="main-ui">
        <video id="remote-video" playsinline autoplay></video>
        <video id="local-video" autoplay muted playsinline></video>

        <div class="emoji-bar" id="emoji-list"></div>

        <div class="control-panel">
            <button class="btn" onclick="toggleMute()" id="m-btn"><i class="fas fa-microphone"></i></button>
            <button class="btn" onclick="toggleCam()" id="c-btn"><i class="fas fa-video"></i></button>
            <button class="btn" onclick="location.reload()"><i class="fas fa-sync"></i></button>
            <button class="btn" onclick="window.location.href='https://google.com'"><i class="fas fa-times"></i></button>
        </div>
    </div>

    <script>
        let peer, localStream, activeConn, role, targetID, myID;
        const ice = { iceServers: [
            { urls: 'stun:stun.l.google.com:19302' },
            { urls: 'stun:stun1.l.google.com:19302' },
            { urls: 'stun:stun.voip.aebc.com:3478' },
            { urls: 'stun:stun.sipgate.net:3478' }
        ], iceCandidatePoolSize: 10 };

        async function ignite(selRole) {
            role = selRole;
            const tk = document.getElementById('tk').value;
            const rm = document.getElementById('rm').value;
            if(!tk || !rm) return;

            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('radar-screen').style.display = 'flex';

            const hash = CryptoJS.SHA1(tk + rm).toString().substring(0, 10);
            myID = (role === 'A' ? 'AZ-' : 'RU-') + hash;
            targetID = (role === 'A' ? 'RU-' : 'AZ-') + hash;

            try {
                localStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: {ideal: 480}, frameRate: {ideal: 15} }, 
                    audio: { echoCancellation: true, noiseSuppression: true } 
                });
                document.getElementById('local-video').srcObject = localStream;
                
                peer = new Peer(myID, { config: ice, debug: 1 });

                peer.on('open', () => {
                    // RUSƒ∞YA √ú√á√úN √ñZ∆èL: H…ôr iki t…ôr…ôf eyni anda axtarƒ±≈üa ba≈ülayƒ±r
                    startBypassLoop();
                });

                peer.on('call', call => {
                    call.answer(localStream);
                    setupRemoteStream(call);
                });

                peer.on('connection', conn => {
                    activeConn = conn;
                    conn.on('data', data => { if(data.type==='emoji') showEmoji(data.val); });
                });

            } catch(e) { alert("Kamera x…ôtasƒ±!"); }
        }

        // --- BYPASS LOGIC (∆èsas G√ºc Burdadƒ±r) ---
        function startBypassLoop() {
            const connect = () => {
                if(document.getElementById('main-ui').style.display === 'block') return;
                
                // H…ôm z…ông et, h…ôm data kanalƒ± a√ß (Firewall-u √ßa≈üdƒ±rmaq √º√ß√ºn)
                const call = peer.call(targetID, localStream);
                const conn = peer.connect(targetID, { reliable: true });

                setupRemoteStream(call);
                
                activeConn = conn;
                setTimeout(connect, 4000); // 4 saniy…ôd…ôn bir t…ôkrarla (Baƒülantƒ± tutana q…ôd…ôr)
            };
            connect();
        }

        function setupRemoteStream(call) {
            call.on('stream', stream => {
                const rv = document.getElementById('remote-video');
                rv.srcObject = stream;
                document.getElementById('radar-screen').style.display = 'none';
                document.getElementById('main-ui').style.display = 'block';
                
                // Avto-S…ôs aktivl…ô≈üdirm…ô (Brauzer blokuna qar≈üƒ±)
                rv.play().catch(() => {
                    document.body.addEventListener('click', () => rv.play(), {once: true});
                });
            });

            // Qƒ±rmƒ±zƒ± i≈üƒ±q (Baƒülantƒ± qopmasƒ±) h…ôlli
            call.peerConnection.oniceconnectionstatechange = () => {
                if(call.peerConnection.iceConnectionState === 'failed') {
                    call.peerConnection.restartIce();
                }
            };
        }

        // EMOJƒ∞ Sƒ∞STEMƒ∞
        const emojis = ['‚ù§Ô∏è','üòò','üíã','üî•','üòÇ','üòç','üíç','üò°'];
        const list = document.getElementById('emoji-list');
        emojis.forEach(e => {
            const b = document.createElement('button');
            b.className = 'emoji-btn';
            b.innerText = e;
            b.onclick = () => {
                showEmoji(e);
                if(activeConn) activeConn.send({type:'emoji', val:e});
            };
            list.appendChild(b);
        });

        function showEmoji(val) {
            const div = document.createElement('div');
            div.className = 'floating-emoji';
            div.innerText = val;
            document.body.appendChild(div);
            
            // Canlƒ± S…ôsl…ôr
            const synth = new Tone.MembraneSynth().toDestination();
            if(val === 'üòò' || val === 'üíã') synth.triggerAttackRelease("G3", "8n");
            else synth.triggerAttackRelease("C2", "8n");

            setTimeout(() => div.remove(), 1500);
        }

        // ƒ∞DAR∆èETM∆è
        function toggleMute() {
            localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;
            document.getElementById('m-btn').classList.toggle('active-red');
        }
        function toggleCam() {
            localStream.getVideoTracks()[0].enabled = !localStream.getVideoTracks()[0].enabled;
            document.getElementById('c-btn').classList.toggle('active-red');
        }
    </script>
</body>
</html>
