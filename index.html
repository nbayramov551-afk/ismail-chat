<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OMEGA GOD MODE V13</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --green: #00a884; --dark: #111b21; --panel: #202c33; --txt: #e9edef; --bubble-m: #005c4b; --bubble-t: #202c33; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--dark); color: var(--txt); height: 100vh; overflow: hidden; position: fixed; width: 100%; }
        
        /* AUTH SECTION */
        #auth { position: fixed; inset: 0; background: var(--dark); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .auth-box { background: var(--panel); padding: 40px 30px; border-radius: 25px; width: 90%; max-width: 400px; text-align: center; border: 1px solid var(--green); box-shadow: 0 0 20px rgba(0,168,132,0.2); }
        .boss-in { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #2a3942; background: #2a3942; color: #fff; margin: 20px 0; font-size: 16px; outline: none; transition: 0.3s; }
        .boss-in:focus { border-color: var(--green); }

        /* APP LAYOUT */
        .app { display: none; height: 100vh; flex-direction: column; }
        .head { background: var(--panel); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .tabs { display: flex; background: var(--panel); border-bottom: 1px solid #2a3942; }
        .tab { flex: 1; padding: 15px; text-align: center; color: #8696a0; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .tab.active { color: var(--green); border-bottom: 3px solid var(--green); }
        
        /* LISTS */
        .list { flex: 1; overflow-y: auto; background: var(--dark); }
        .row { display: flex; align-items: center; padding: 15px 20px; border-bottom: 0.5px solid #222; cursor: pointer; }
        .row:active { background: #2a3942; }
        .av { width: 52px; height: 52px; border-radius: 50%; background: #6a7175; margin-right: 15px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 20px; text-transform: uppercase; }

        /* CHAT WINDOW */
        .chat { position: fixed; inset: 0; background: #0b141a; z-index: 5000; transform: translateX(100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
        .chat.active { transform: translateX(0); }
        .msgs { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 4px; background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-repeat: repeat; }
        .b { max-width: 85%; padding: 8px 12px; border-radius: 10px; font-size: 15px; position: relative; line-height: 1.4; color: #fff; box-shadow: 0 1px 1px rgba(0,0,0,0.2); }
        .m { align-self: flex-end; background: var(--bubble-m); border-bottom-right-radius: 0; }
        .t { align-self: flex-start; background: var(--bubble-t); border-bottom-left-radius: 0; }
        .time { font-size: 10px; color: rgba(255,255,255,0.6); float: right; margin-top: 4px; margin-left: 8px; }
        
        .inp-bar { background: var(--panel); padding: 8px 12px; display: flex; align-items: center; gap: 10px; }
        .wa-in { flex: 1; background: #2a3942; border: none; padding: 10px 15px; border-radius: 20px; color: #fff; outline: none; font-size: 16px; }

        /* CALL OVERLAY */
        #call { position: fixed; inset: 0; background: #000; z-index: 20000; display: none; flex-direction: column; }
        .v-rem { width: 100%; height: 100%; object-fit: cover; }
        .v-loc { position: absolute; top: 50px; right: 20px; width: 110px; height: 160px; border-radius: 15px; border: 2px solid #fff; object-fit: cover; z-index: 21; }
        .c-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.3); display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 100px 0; }
        .c-btns { display: flex; gap: 30px; z-index: 100; margin-bottom: 50px; }
        .btn-round { width: 70px; height: 70px; border-radius: 50%; border: none; display: flex; align-items: center; justify-content: center; font-size: 28px; color: #fff; cursor: pointer; transition: 0.2s; }
    </style>
</head>
<body>

    <audio id="snd_msg" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3" preload="auto"></audio>
    <audio id="snd_ring" src="https://assets.mixkit.co/active_storage/sfx/1359/1359-preview.mp3" loop preload="auto"></audio>
    <audio id="snd_dial" src="https://www.soundjay.com/phone/phone-calling-1.mp3" loop preload="auto"></audio>

    <div id="auth">
        <div class="auth-box">
            <h1 style="color:var(--green); letter-spacing: 2px;">OMEGA V13</h1>
            <p style="color:#8696a0;">MOSCOW SECURE LINE</p>
            <input type="text" id="boss_user" class="boss-in" placeholder="Adınızı yazın Boss...">
            <button onclick="bootSystem()" style="width:100%; padding:15px; border-radius:12px; border:none; background:var(--green); font-weight:900; color:#fff; cursor:pointer;">QOŞUL</button>
        </div>
    </div>

    <div class="app" id="app">
        <div class="head">
            <b style="font-size:24px; color:var(--green);">Omega Boss</b>
            <div style="display:flex; gap:25px; font-size:20px; color:#8696a0;">
                <i class="fas fa-search"></i>
                <i class="fas fa-user-plus" onclick="addContact()"></i>
                <i class="fas fa-ellipsis-v"></i>
            </div>
        </div>
        <div class="tabs">
            <div class="tab active" onclick="switchTab('chats', this)">ÇATLAR</div>
            <div class="tab" onclick="switchTab('status', this)">STATUS</div>
            <div class="tab" onclick="switchTab('calls', this)">ZƏNGLƏR</div>
        </div>
        
        <div id="chats-list" class="list"></div>
        <div id="status-list" class="list" style="display:none; padding:20px; text-align:center;">
            <p style="color:#8696a0;">Status funksiyası aktivdir.</p>
        </div>
        <div id="calls-list" class="list" style="display:none; padding:20px; text-align:center;">
            <p style="color:#8696a0;">Zəng tarixçəsi şifrələnib.</p>
        </div>
    </div>

    <div class="chat" id="chatwin">
        <div class="head">
            <div style="display:flex; align-items:center; gap:12px;">
                <i class="fas fa-arrow-left" onclick="closeChat()"></i>
                <div class="av" id="chat-av" style="width:38px; height:38px; font-size:14px;"></div>
                <div>
                    <b id="chat-title">...</b><br>
                    <small style="color:var(--green); font-size:11px;">Onlayn</small>
                </div>
            </div>
            <div style="display:flex; gap:25px; font-size:18px; color:#8696a0;">
                <i class="fas fa-video" onclick="initiateCall(true)"></i>
                <i class="fas fa-phone-alt" onclick="initiateCall(false)"></i>
            </div>
        </div>
        <div class="msgs" id="msg-feed"></div>
        <div class="inp-bar">
            <i class="far fa-smile" style="font-size:24px; color:#8696a0;"></i>
            <input type="text" id="msg-input" class="wa-in" placeholder="Mesaj yazın...">
            <i class="fas fa-microphone" id="mic-btn" style="font-size:22px; color:#8696a0;" onmousedown="startVoice()" onmouseup="stopVoice()" ontouchstart="startVoice()" ontouchend="stopVoice()"></i>
            <button onclick="handleSend()" style="background:none; border:none; color:var(--green); font-size:24px;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="call">
        <video id="v-remote" class="v-rem" autoplay playsinline></video>
        <video id="v-local" class="v-loc" autoplay muted playsinline></video>
        <div class="c-overlay">
            <div style="text-align:center;">
                <h2 id="call-name" style="font-size:32px; text-shadow: 2px 2px 10px #000;">DOST</h2>
                <p id="call-status" style="letter-spacing:2px; margin-top:10px; font-weight:600;">ZƏNG EDİLİR...</p>
            </div>
            <div class="c-btns">
                <button id="btn-accept" class="btn-round" style="background:#25D366; display:none;" onclick="answerCall()"><i class="fas fa-phone"></i></button>
                <button class="btn-round" style="background:#ff3b3b;" onclick="hangup()"><i class="fas fa-phone-slash"></i></button>
            </div>
        </div>
    </div>

    <script>
        let me, peer, activeChatId = null, myStream, currentCall, mediaRec, audioChunks = [];
        const MASTER_KEY = "OMEGA_V13_GOD_MODE_STRENGTH_256";

        function bootSystem() {
            const name = document.getElementById('boss_user').value;
            if(!name) return;
            const id = "BOSS-" + Math.floor(1000 + Math.random() * 9999);
            me = { id, name };
            localStorage.setItem('omega_profile', JSON.stringify(me));
            location.reload();
        }

        window.onload = () => {
            const profile = localStorage.getItem('omega_profile');
            if(!profile) return;
            me = JSON.parse(profile);
            document.getElementById('auth').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            
            peer = new Peer(me.id, {
                config: {'iceServers': [{ urls: 'stun:stun.l.google.com:19302' }, { urls: 'stun:stun1.l.google.com:19302' }]}
            });

            peer.on('connection', conn => {
                conn.on('data', data => processIncoming(data));
            });

            peer.on('call', call => {
                currentCall = call;
                document.getElementById('call').style.display = 'flex';
                document.getElementById('btn-accept').style.display = 'flex';
                document.getElementById('call-status').innerText = "DAXİLİ ZƏNG...";
                document.getElementById('snd_ring').play().catch(()=>{});
            });

            renderChatList();
        };

        function addContact() {
            const id = prompt("Dostun BOSS ID-si:");
            if(!id || id === me.id) return;
            let db = JSON.parse(localStorage.getItem('omega_db') || "[]");
            if(!db.find(x => x.id === id)) {
                db.push({id, name: "Dost", msgs: []});
                localStorage.setItem('omega_db', JSON.stringify(db));
            }
            renderChatList();
        }

        function renderChatList() {
            const container = document.getElementById('chats-list');
            container.innerHTML = "";
            const db = JSON.parse(localStorage.getItem('omega_db') || "[]");
            db.forEach(u => {
                container.innerHTML += `
                    <div class="row" onclick="openChat('${u.id}')">
                        <div class="av">${u.id[5]}</div>
                        <div style="flex:1">
                            <b>${u.id}</b><br>
                            <small style="color:#8696a0;">Hərbi səviyyəli şifrələmə aktivdir</small>
                        </div>
                    </div>`;
            });
        }

        function openChat(id) {
            activeChatId = id;
            document.getElementById('chat-title').innerText = id;
            document.getElementById('chat-av').innerText = id[5];
            document.getElementById('chatwin').classList.add('active');
            renderMessages();
        }

        function handleSend() {
            const text = document.getElementById('msg-input').value;
            if(!text) return;
            const msg = { f: me.id, t: 'txt', b: text, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) };
            syncAndSend(msg);
            document.getElementById('msg-input').value = "";
        }

        function syncAndSend(obj) {
            let db = JSON.parse(localStorage.getItem('omega_db'));
            db.find(x => x.id === activeChatId).msgs.push(obj);
            localStorage.setItem('omega_db', JSON.stringify(db));
            
            const conn = peer.connect(activeChatId);
            conn.on('open', () => {
                const cipher = CryptoJS.AES.encrypt(JSON.stringify(obj), MASTER_KEY).toString();
                conn.send(cipher);
                renderMessages();
            });
        }

        function processIncoming(cipher) {
            try {
                const dec = CryptoJS.AES.decrypt(cipher, MASTER_KEY).toString(CryptoJS.enc.Utf8);
                const data = JSON.parse(dec);
                let db = JSON.parse(localStorage.getItem('omega_db') || "[]");
                let sender = db.find(x => x.id === data.f);
                if(sender) {
                    sender.msgs.push(data);
                    localStorage.setItem('omega_db', JSON.stringify(db));
                    if(activeChatId === data.f) renderMessages();
                    document.getElementById('snd_msg').play().catch(()=>{});
                }
            } catch(e) { console.error("Decryption error"); }
        }

        function renderMessages() {
            const feed = document.getElementById('msg-feed');
            feed.innerHTML = "";
            const db = JSON.parse(localStorage.getItem('omega_db'));
            const chat = db.find(x => x.id === activeChatId);
            chat.msgs.forEach(m => {
                const side = m.f === me.id ? 'm' : 't';
                if(m.t === 'txt') {
                    feed.innerHTML += `<div class="b ${side}">${m.b} <span class="time">${m.time}</span></div>`;
                } else {
                    feed.innerHTML += `<div class="b ${side}" onclick="new Audio('${m.b}').play()"><i class="fas fa-play"></i> Səsli Mesaj <span class="time">${m.time}</span></div>`;
                }
            });
            feed.scrollTop = feed.scrollHeight;
        }

        async function initiateCall(video) {
            document.getElementById('call').style.display = 'flex';
            document.getElementById('snd_dial').play().catch(()=>{});
            myStream = await navigator.mediaDevices.getUserMedia({video, audio: true});
            document.getElementById('v-local').srcObject = myStream;
            currentCall = peer.call(activeChatId, myStream);
            currentCall.on('stream', rs => {
                killSounds();
                document.getElementById('call-status').innerText = "BAĞLANTI QURULDU";
                document.getElementById('v-remote').srcObject = rs;
            });
        }

        async function answerCall() {
            killSounds();
            document.getElementById('btn-accept').style.display = 'none';
            myStream = await navigator.mediaDevices.getUserMedia({video: true, audio: true});
            document.getElementById('v-local').srcObject = myStream;
            currentCall.answer(myStream);
            currentCall.on('stream', rs => {
                document.getElementById('call-status').innerText = "BAĞLANTI QURULDU";
                document.getElementById('v-remote').srcObject = rs;
            });
        }

        function startVoice() {
            navigator.mediaDevices.getUserMedia({audio: true}).then(s => {
                mediaRec = new MediaRecorder(s);
                mediaRec.ondataavailable = e => audioChunks.push(e.data);
                mediaRec.onstop = () => {
                    const r = new FileReader();
                    r.onload = () => syncAndSend({f: me.id, t:'aud', b: r.result, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})});
                    r.readAsDataURL(new Blob(audioChunks)); audioChunks = [];
                };
                mediaRec.start();
                document.getElementById('mic-btn').style.color = 'red';
            });
        }
        function stopVoice() { if(mediaRec) { mediaRec.stop(); document.getElementById('mic-btn').style.color = '#8696a0'; } }
        
        function killSounds() {
            document.getElementById('snd_ring').pause();
            document.getElementById('snd_dial').pause();
            document.getElementById('snd_ring').currentTime = 0;
            document.getElementById('snd_dial').currentTime = 0;
        }

        function hangup() { location.reload(); }
        function closeChat() { document.getElementById('chatwin').classList.remove('active'); activeChatId = null; }
        function switchTab(t, el) {
            document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('chats-list').style.display = t === 'chats' ? 'block' : 'none';
            document.getElementById('status-list').style.display = t === 'status' ? 'block' : 'none';
            document.getElementById('calls-list').style.display = t === 'calls' ? 'block' : 'none';
        }
    </script>
</body>
</html>
