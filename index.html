<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHANTOM_V35_ULTRA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; height: 100vh; }
        #login-screen { position: fixed; inset: 0; background: radial-gradient(circle, #051005 0%, #000 100%); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .terminal-box { border: 1px solid #0f0; padding: 30px; width: 320px; background: rgba(0,0,0,0.9); box-shadow: 0 0 30px #0f0; border-radius: 15px; text-align: center; }
        input { background: #000; border: 1px solid #0f0; color: #0f0; padding: 12px; margin: 10px 0; width: 100%; box-sizing: border-box; outline: none; border-radius: 5px; }
        .start-btn { width: 100%; padding: 15px; background: #0f0; color: #000; font-weight: bold; cursor: pointer; border: none; text-transform: uppercase; border-radius: 5px; box-shadow: 0 0 10px #0f0; }
        #main-ui { display: none; width: 100vw; height: 100vh; position: relative; }
        video { width: 100%; height: 100%; object-fit: cover; background: #010101; }
        #local-v { position: absolute; bottom: 110px; right: 20px; width: 120px; height: 160px; border: 1px solid #0f0; z-index: 10; border-radius: 10px; object-fit: cover; }
        #status-bar { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.85); color: #0f0; font-size: 11px; padding: 8px; text-align: center; z-index: 100; border-bottom: 1px solid #0f0; letter-spacing: 1px; }
        .lock-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.97); z-index: 500; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .panic-btn { width: 160px; height: 160px; border-radius: 50%; background: #0f0; border: 8px solid #000; color: #000; font-weight: 900; cursor: pointer; box-shadow: 0 0 40px #0f0; animation: pulse 0.8s infinite; font-size: 18px; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 20px #0f0; } 50% { transform: scale(1.05); box-shadow: 0 0 50px #0f0; } 100% { transform: scale(1); box-shadow: 0 0 20px #0f0; } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="terminal-box">
            <h2 style="letter-spacing: 5px; margin-bottom: 5px;">PHANTOM V35</h2>
            <p style="font-size: 10px; color: #0f0; margin-bottom: 20px;">GENESIS BYPASS // ENCRYPTED RELAY</p>
            <input type="password" id="tk" placeholder="TOKEN (Gƒ∞ZLƒ∞)">
            <input type="text" id="rm" placeholder="ROOM_ID (Gƒ∞ZLƒ∞)">
            <div style="display: flex; gap: 8px;">
                <button class="start-btn" onclick="run('A')" style="font-size: 11px;">TUNEL A√á (AZ)</button>
                <button class="start-btn" onclick="run('B')" style="font-size: 11px; background: #003300; color: #0f0; border: 1px solid #0f0;">Sƒ∞QNAL TUT (RU)</button>
            </div>
        </div>
    </div>

    <div id="main-ui">
        <div id="status-bar">Sƒ∞STEM: TUNEL G√ñZL∆èNƒ∞Lƒ∞R...</div>
        <video id="rv" playsinline autoplay></video>
        <video id="lv" autoplay muted playsinline></video>
        
        <div class="lock-screen" id="lock">
            <button class="panic-btn" onclick="unlock()">Sƒ∞QNALI<br>DE≈û!</button>
            <p style="margin-top: 25px; color: #0f0; font-size: 13px; font-weight: bold;">Gƒ∞ZLƒ∞ X∆èTT TAPILDI!</p>
        </div>
    </div>

    <script>
        let peer, stream, role, callLoop;
        const log = t => document.getElementById('status-bar').innerText = "Sƒ∞STEM: " + t;

        // üõ°Ô∏è ƒ∞SRAƒ∞L V∆è AVROPA G√úC√úND∆è STUN/TURN RELAY
        const ice = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' },
                { urls: 'stun:stun2.l.google.com:19302' },
                { urls: 'stun:stun.ekiga.net' },
                { urls: 'stun:stun.ideasip.com' },
                { urls: 'stun:stun.rixtelecom.se' }
            ],
            iceTransportPolicy: 'all'
        };

        async function run(r) {
            role = r;
            const tk = document.getElementById('tk').value.trim().toLowerCase();
            const rm = document.getElementById('rm').value.trim().toLowerCase();
            if(!tk || !rm) return alert("Giri≈ü kodlarƒ±nƒ± daxil edin!");

            // üî± ULTRA-HASH (SHA-256)
            const hash = CryptoJS.SHA256(tk + "GENESIS" + rm).toString().substring(0, 12);
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';

            try {
                // üî± ADAPTIVE BANDWIDTH (Donmamaq √º√ß√ºn a≈üaƒüƒ±dan ba≈ülayƒ±b qalxƒ±r)
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: {ideal: 640}, height: {ideal: 480}, frameRate: {max: 24} }, 
                    audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true } 
                });
                document.getElementById('lv').srcObject = stream;

                peer = new Peer((role=='A'?'AZ-':'RU-')+hash, {
                    host: 'phantom-server-hwhx.onrender.com', // S…ônin Render serverin
                    port: 443,
                    secure: true,
                    config: ice,
                    debug: 0
                });

                peer.on('open', id => {
                    log(role=='A'?"TUNEL A√áIQ. Sƒ∞QNAL G√ñZL∆èNƒ∞Lƒ∞R...":"BAƒûLANTI AXTARILIR...");
                    
                    // üî± AGGRESSIVE RE-DIAL (H…ôr 3 saniy…ôd…ôn bir tuneli de≈üm…ôy…ô √ßalƒ±≈üƒ±r)
                    if(role=='B') {
                        callLoop = setInterval(() => {
                            if (document.getElementById('lock').style.display !== 'none' || document.getElementById('rv').srcObject) return;
                            const call = peer.call('AZ-'+hash, stream);
                            if(call) bind(call);
                        }, 3000);
                    }
                });

                peer.on('call', call => {
                    call.answer(stream);
                    bind(call);
                });

                peer.on('error', e => {
                    if(e.type === 'peer-unavailable') log("QAR≈ûI T∆èR∆èF DEYƒ∞L...");
                    else log("X∆èTA: TUNEL YENƒ∞L∆èNƒ∞R...");
                });

            } catch(e) { log("ƒ∞CAZ∆è R∆èDD EDƒ∞LDƒ∞!"); }
        }

        function bind(call) {
            call.on('stream', rs => {
                const rv = document.getElementById('rv');
                rv.srcObject = rs;
                document.getElementById('lock').style.display = 'flex';
                log("Sƒ∞QNAL ≈ûƒ∞FR∆èSƒ∞ A√áILDI!");
                if(callLoop) clearInterval(callLoop);
            });
        }

        function unlock() {
            const rv = document.getElementById('rv');
            rv.play().then(() => {
                document.getElementById('lock').style.display = 'none';
                log("TUNEL ≈ûƒ∞FR∆èL∆èNDƒ∞ // AKTƒ∞V");
            }).catch(() => {
                rv.muted = true;
                rv.play();
                document.getElementById('lock').style.display = 'none';
                log("S∆èSƒ∞ ∆èLL∆è AKTƒ∞V EDƒ∞N!");
            });
        }
    </script>
</body>
</html>
